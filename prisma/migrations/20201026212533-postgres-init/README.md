# Migration `20201026212533-postgres-init`

This migration has been generated by Rinat at 10/27/2020, 12:25:33 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."companies" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."bids" (
"id" text   NOT NULL ,
"type" "BidType"  NOT NULL ,
"resourse" "Resourse"  NOT NULL ,
"coalMark" "CoalMark"  NOT NULL ,
"volume" Decimal(65,30)   NOT NULL ,
"price" Decimal(65,30)   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."deals" (
"id" text   NOT NULL ,
"buyerBidId" text   NOT NULL ,
"sellerBidId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."locations" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"code" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "companies.name_unique" ON "public"."companies"("name")

CREATE UNIQUE INDEX "deals.buyerBidId_sellerBidId_unique" ON "public"."deals"("buyerBidId", "sellerBidId")

CREATE UNIQUE INDEX "deals_buyerBidId_unique" ON "public"."deals"("buyerBidId")

CREATE UNIQUE INDEX "deals_sellerBidId_unique" ON "public"."deals"("sellerBidId")

CREATE UNIQUE INDEX "locations.code_unique" ON "public"."locations"("code")

CREATE UNIQUE INDEX "users.email_unique" ON "public"."users"("email")

ALTER TABLE "public"."deals" ADD FOREIGN KEY ("buyerBidId")REFERENCES "public"."bids"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."deals" ADD FOREIGN KEY ("sellerBidId")REFERENCES "public"."bids"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."users" ADD FOREIGN KEY ("companyId")REFERENCES "public"."companies"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201026212533-postgres-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,128 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+enum Role {
+  BUYER
+  SELLER
+  MATCHER
+}
+
+enum Resourse {
+  COAL
+}
+
+enum BidType {
+  DEMAND
+  OFFER
+}
+
+enum CoalMark {
+  LONG_FLAME
+  LONG_FLAME_GAS
+  GAS
+  GAS_CAKING
+  GAS_FAT_WEAKLY_CAKING
+  GAS_FAT_SEMI_LEAN
+  GAS_FAT
+  FAT
+  FAT_SECOND
+  COKE_FAT
+  COKE
+  SEMI_LEAN_COKE
+  SEMI_LEAN_CAKING
+  COKE_WEAKLY_CAKING
+  LOW_METAMORPHOSED
+  WEAKLY_CAKING
+  LEAN_CAKING
+  LEAN
+}
+
+enum CoalFraction {
+  LEAN
+  PLATE
+  BIG
+  NUT
+  SMALL
+  SEED
+  RUBBLE
+  RAW
+}
+
+model UserModel {
+  id       String  @id @default(cuid())
+
+  email    String  @unique
+  fullName String?
+  phone    String?
+  password String
+  companyId String?
+
+  role     Role    @default(BUYER)
+  company CompanyModel? @relation(fields: [companyId], references: [id])
+
+  createdAt DateTime @default(now())
+
+  @@map("users")
+}
+
+model CompanyModel {
+    id       String  @id @default(cuid())
+
+  name String @unique
+  users UserModel[]
+
+  createdAt DateTime @default(now())
+
+  @@map("companies")
+}
+
+model BidModel {
+  id       String  @id @default(cuid())
+  
+  type BidType
+  resourse Resourse
+  coalMark CoalMark
+  buyerDeal DealModel  @relation("buyer_bid_deals")
+  sellerDeal DealModel @relation("seller_bid_deals")
+
+  volume Float
+  price Float
+
+
+  createdAt DateTime @default(now())
+
+  @@map("bids")
+
+}
+
+model DealModel {
+  id       String  @id @default(cuid())
+
+  buyerBidId String
+  sellerBidId String
+  
+  buyerBid BidModel @relation("buyer_bid_deals", fields: [buyerBidId], references: [id])
+  sellerBid BidModel @relation("seller_bid_deals", fields: [sellerBidId], references: [id])
+
+  createdAt DateTime @default(now())
+
+  @@unique([buyerBidId, sellerBidId])
+  @@map("deals")
+}
+
+model LocationModel {
+    id       String  @id @default(cuid())
+
+  name String
+  code String @unique
+
+  createdAt DateTime @default(now())
+
+  @@map("locations")
+}
```


